# defIUT

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with this program. If not, see <https://www.gnu.org/licenses/>

Ce programme est un logiciel libre ; vous pouvez le redistribuer ou le modifier suivant les termes de la GNU General Public License telle que publiée par la Free Software Foundation ; soit la version 3 de la licence, soit (à votre gré) toute version ultérieure.
Ce programme est distribué dans l'espoir qu'il sera utile, mais SANS AUCUNE GARANTIE ; sans même la garantie tacite de QUALITÉ MARCHANDE ou d'ADÉQUATION à UN BUT PARTICULIER. Consultez la GNU General Public License pour plus de détails.
Vous devez avoir reçu une copie de la GNU General Public License en même temps que ce programme ; si ce n'est pas le cas, consultez <http://www.gnu.org/licenses>

Environment composition:

- Docker Compose
- Nginx, PHP-FPM 7.2 and Xdebug (works on macOS)
- MySQL
- Symfony 4.2
- Node, Webpack and Vue.js

## Project structure

```
.
├── app // Symfony app directory
│   ├── assets // Folder generated by symfony/webpack-encore-bundle
│   │   └── vue
│   ├── bin
│   ├── config // Symfony app config
│   │   ├── packages
│   │   │   ├── dev
│   │   │   ├── prod
│   │   │   └── test
│   │   └── routes
│   │       └── dev
│   ├── public // This is where the index.php lies
│   │   └── build // And that is responsible for building your js to index.js
│   ├── src // Your Symfony app core stuff
│   │   ├── Controller
│   │   ├── Entity
│   │   ├── Migrations
│   │   └── Repository
│   ├── templates // Twig templates
│   ├── tests
│   ├── translations
│   └── var 
│       ├── cache
│       └── log
├── docker 
│   ├── config // Directory with nginx/php configurations. 
│   │   ├── nginx
│   │   │   ├── hosts
│   │   │   └── xdebug
│   │   └── php
│   └── php // Here lies php Dockerfile
└── logs // Docker containers' logs

```

## Installation

1. Create a `./.env` from the `./.env.dist` file. Adapt it according to your symfony application

    ```bash
    cp .env.dist .env
    ```

2. Set up database connection
  
    Take care about DATABASE_URL parameter in `./app/.env`
  
3. Build and run Docker containers
   
    Make sure that 80 port is not in use or change Nginx port in `./docker/config/nginx/hosts/default.conf` and also in docker-compose files
   
    ```bash
    docker-compose up --build -d
    ```
    
    > **Note:**  
    Docker containers can be launched with [docker-sync](http://docker-sync.io/)  
    I **highly recommend** macOS users to use that way because of these [performance tests](https://github.com/EugenMayer/docker-sync/wiki/4.-Performance)  
    My page loading time decreased from 8 seconds to 250 ms  
    To use it you need to install docker-sync on your machine (link above)  
    After you build Docker container with `docker-compose build`  
    Use `make start_dev` and `make stop_dev` to control your containers  
    >
    
    > If you don't need [docker-sync](http://docker-sync.io/) delete `docker-compose-dev.yml` `docker-sync.yml` and `Makefile` from the project root

4. Install vendors
    
    ```bash
    cd ./app
    composer install
    npm install
    ```
    
## Usage

* Run your containers 
  > `docker-compose up -d` or  `make start_dev`
* Run webpack watch command `npm run watch`
  > You can also find `dev` adn `build` commands in package.json file 
* Go to http://localhost:80/  
  Welcome to your application!
  ![](https://i.imgur.com/To5ykhz.png "")

## PhpStorm config

1. Use Docker container's PHP  

   Go to `Preferences > Languages & Frameworks > PHP`  
   Click on `...` near the CLI Interpreter  
   Add new instance from Docker  
   ![](https://i.imgur.com/kk8Kvl5.png "")  
   
2. Use path mappings  

   Go to `Preferences > Languages & Frameworks > PHP > Servers`  
   Create mappings from your `./app` to `var/www/app`  
   ![](https://i.imgur.com/ljv7h4I.png "")  
   
3. Xdebug config

   Go to `Preferences > Languages & Frameworks > PHP > Debug`  
   ![](https://i.imgur.com/KT8pEcd.png "")  

4. Database configuration  

   Use 3307 for mysql connection port or change it in docker-compose files

   ![](https://i.imgur.com/1mhkvCW.png "")  
